---
layout: post
title: "Garbage Collector"
date: 2019-12-22 19:30:00 +0000
description: About garbage collector
categories: devinfo
tags: C# Java
---

C#과 Java를 쓰는 사람이면 한번쯤 들어본 `GC` 라고 불리는 기능이다. GC라는 것은 쉽게 말하면 알아서 메모리를 관리해주는 고급언어의 기능이다. 이 기능이 중요한 이유는 여러가지가 있는데 편리성을 제공해주는 만큼 반대적인 성향도 있기 때문이다. 간단하게 표현해서 개발자가 해야할 일을 줄여서 생산성의 극대화를 이루게 만들었지만 개발자가 할 수 없는 영역이 생겨서 성능상의 문제를 야기할 수 있다 라고 생각한다. 대용량 데이터를 처리하거나 속도에 관련된 이슈가 발생하였을 때 이 기능 때문이라고 한다면 원인파악이 어렵다는 점이 있다.

---

## 개념

Java, C# 등 `GC`의 기능은 같다. 메모리를 관리하고 해제해준다 가 기본이다. (개발자가 신경쓰지 않아도 된다?? 는 아니다, 아래에서 설명)
내부적인 동작 방식의 차이점은 있지만 전체적인 맥락을 정리하자면,

### Generation
선언된 메모리를 참조하는 영역이 존재한다. 세대(Generation)이라고 지칭한다. 언어마다 세대를 구성하는 방식의 차이는 있어보이지만 결국은 세대라고 지칭하는 공간을 갖고 있다. 예를 들어 C#은 0세대 1세대 2세대, Java는 young generation, old generation 과 같이 각 세대를 구분한다. Java는 세대 안에서도 eden과 survivor 라는 영역을 나누지만 결국은 전체적인 개념은 세대를 구분하는 것이라고 생각한다.

### Garbage Collection(GC)
특정 세대의 공간을 초과하면 Garbage Collection이 발생한다. 직역하자면 쓰레기 수집이라는 이 동작은 `더 이상 메모리 참조가 되지 않는` 또는 `Unreachable` 이라고 하는 상태가 되는 경우 메모리를 해제하는 동작이다. 일반적으로 선언된 메모리를 기록하고 있다가 GC가 동작할 때 위와 같은 상태의 메모리는 소거한다. 그러나 위와 같은 상태가 되지 않은 경우 해당 메모리는 다음 세대로 넘어간다. 구체적인 동작은 언어마다 조금씩 차이가 있으며 검색시 많은 내용들이 있다. 주의할 점은 이 동작이 수행될 경우, GC라는 이 동작을 위해 모든 쓰레드가 멈추기 때문에 강제로 호출하는 것은 좋은 방법이 아니다. Java에서는 stop the world 라고도 한다.

---

## 장단점

### 장점
생산성의 극대화, 개발의 문턱을 낮춘 기능 등의 수식어가 잘 어울린다. 옛날 C, C++ 언어들의 메모리 관리 방법은 많은 전공생들을 포기하게 만든 기능 중에 하나라고 생각한다.

### 단점
메모리 관리를 개발자가 직접 관리하지 않기 때문에 런타임 중 어느 시점에 메모리가 해제되는지 알 수 없다. 때문에 많은 메모리가 필요한 개발 영역에서는 이를 해결하기 위해 많은 노력이 필요하다. 또한 너무 자주 발생한다면 처리 속도에 대한 이슈를 겪을 수도 있다.

---

### 주의사항

C# 개발에는 GC 참조에 걸리지 않는 객체 종류가 있음을 기억해둬야 한다. 예를 들어 Bitmap 같은 것이 있다. 선언시 엄청난 메모리를 차지하지만 GC에 걸리지 않으므로 가장 쉽게 뻗기 쉬운 프로그램을 만들 수 있다. C#에서 메모리 관리를 위한 좋은 방법 중 하나는 IDisposable 인터페이스를 상속 받았다면 using 키워드를 사용하거나 사용 즉시 Dispose를 호출해주는 방법이 있다. 그리고 만약 API 개발을 한다면 사용자 메모리 관리를 위해 해당 인터페이스를 상속시켜 주는 것이 좋다. 또한 신규 객체를 생성할 필요가 없는 경우엔 싱글턴이나 캐싱을 사용하여 굳이 많은 객체를 생성하도록 하여 GC에 들어가지 않도록 하는 것이 좋다.
